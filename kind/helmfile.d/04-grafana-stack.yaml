repositories:
  - name: grafana
    url: https://grafana.github.io/helm-charts
  - name: open-telemetry
    url: https://open-telemetry.github.io/opentelemetry-helm-charts
  - name: bitnami
    url: https://charts.bitnami.com/bitnami
  - name: ingress-nginx
    url: https://kubernetes.github.io/ingress-nginx
  - name: prometheus-community
    url: https://prometheus-community.github.io/helm-charts

releases:
  - name: ingress-nginx
    namespace: ingress-nginx
    chart: ingress-nginx/ingress-nginx
    version: 4.14.*
    wait: true
    values:
      - controller:
          service:
            type: NodePort
          hostPort:
            enabled: true
          admissionWebhooks:
            enabled: false
            patch:
              enabled: false
  # 2. Prometheus (Metrics) - Replaces Mimir
  - name: prometheus
    namespace: monitoring
    chart: prometheus-community/prometheus
    version: 25.11.0
    values:
      - ../values/prometheus.yaml

  # 3. Loki (Logs)
  - name: loki
    namespace: monitoring
    chart: grafana/loki
    version: 6.6.6
    values:
      - ../values/loki.yaml

  # 4. Tempo (Traces)
  - name: tempo
    namespace: monitoring
    chart: grafana/tempo
    values:
      - ../values/tempo.yaml

  # 5. Grafana (Visualization)
  - name: grafana
    namespace: monitoring
    chart: grafana/grafana
    disableValidation: true   
    needs:
      - ingress-nginx/ingress-nginx    
      - monitoring/prometheus   
      - monitoring/loki          
    values:
      - ../values/grafana.yaml

  # 6. OpenTelemetry Collector
  - name: otel-collector
    namespace: monitoring
    chart: open-telemetry/opentelemetry-collector
    needs:
      - monitoring/prometheus
      - monitoring/loki
      - monitoring/tempo    
    values:
      - ../values/otel-collector.yaml
