apiVersion: v1
kind: ConfigMap
metadata:
  name: tracing-dashboard
  namespace: monitoring
  labels:
    grafana_dashboard: "1"
data:
  tracing.json: |
   {
     "annotations": {
       "list": [
         {
           "builtIn": 1,
           "datasource": { "type": "grafana", "uid": "-- Grafana --" },
           "enable": true,
           "hide": true,
           "iconColor": "rgba(0, 211, 255, 1)",
           "name": "Annotations & Alerts",
           "type": "dashboard"
         }
       ]
     },
     "description": "Distributed tracing powered by Tempo. View errors, slow traces, and full request flows across all microservices.",
     "editable": true,
     "fiscalYearStartMonth": 0,
     "graphTooltip": 0,
     "id": null,
     "links": [
       {
         "asDropdown": true,
         "icon": "external link",
         "includeVars": false,
         "keepTime": true,
         "tags": [],
         "targetBlank": false,
         "title": "Navigate",
         "type": "dashboards"
       }
     ],
     "liveNow": false,
     "panels": [
       {
         "gridPos": { "h": 3, "w": 24, "x": 0, "y": 0 },
         "id": 1,
         "options": {
           "code": { "language": "markdown", "showLineNumbers": false, "showMiniMap": false },
           "content": "<div style=\"padding:6px 0\">\n  <div style=\"font-size:24px;font-weight:700;color:#fff\">Distributed Tracing</div>\n  <div style=\"font-size:13px;color:#8e8e8e;margin-top:4px\">Powered by <strong style=\"color:#8F3BB8\">Tempo</strong> &mdash; Click on any trace to view the full span waterfall. Services: <strong>orders-service</strong>, <strong>products-service</strong>, <strong>shipping-service</strong></div>\n</div>",
           "mode": "html"
         },
         "transparent": true,
         "type": "text"
       },
       {
         "collapsed": false,
         "gridPos": { "h": 1, "w": 24, "x": 0, "y": 3 },
         "id": 2,
         "panels": [],
         "title": "orders-service",
         "type": "row"
       },
       {
         "datasource": { "type": "tempo", "uid": "${datasource}" },
         "description": "Traces for orders-service with error status or HTTP 500+",
         "gridPos": { "h": 8, "w": 12, "x": 0, "y": 4 },
         "id": 3,
         "options": {
           "cellHeight": "sm",
           "footer": { "countRows": false, "fields": "", "reducer": ["sum"], "show": false },
           "showHeader": true,
           "sortBy": [ { "desc": true, "displayName": "Start time" } ]
         },
         "targets": [
           {
             "datasource": { "type": "tempo", "uid": "${datasource}" },
             "query": "{ resource.service.name = \"orders-service\" && (status = error || span.http.status_code >= 500) }",
             "queryType": "traceql",
             "refId": "A"
           }
         ],
         "title": "Recent Errors (Orders)",
         "type": "table"
       },
       {
         "datasource": { "type": "tempo", "uid": "${datasource}" },
         "description": "Traces for orders-service taking longer than 500ms",
         "gridPos": { "h": 8, "w": 12, "x": 12, "y": 4 },
         "id": 4,
         "options": {
           "cellHeight": "sm",
           "footer": { "countRows": false, "fields": "", "reducer": ["sum"], "show": false },
           "showHeader": true,
           "sortBy": [ { "desc": true, "displayName": "Duration" } ]
         },
         "targets": [
           {
             "datasource": { "type": "tempo", "uid": "${datasource}" },
             "query": "{ resource.service.name = \"orders-service\" && duration > 500ms }",
             "queryType": "traceql",
             "refId": "A"
           }
         ],
         "title": "Slow Traces > 500ms (Orders)",
         "type": "table"
       },
       {
         "collapsed": false,
         "gridPos": { "h": 1, "w": 24, "x": 0, "y": 12 },
         "id": 5,
         "panels": [],
         "title": "products-service",
         "type": "row"
       },
       {
         "datasource": { "type": "tempo", "uid": "${datasource}" },
         "description": "Traces for products-service with error status or HTTP 500+",
         "gridPos": { "h": 8, "w": 12, "x": 0, "y": 13 },
         "id": 6,
         "options": {
           "cellHeight": "sm",
           "footer": { "countRows": false, "fields": "", "reducer": ["sum"], "show": false },
           "showHeader": true,
           "sortBy": [ { "desc": true, "displayName": "Start time" } ]
         },
         "targets": [
           {
             "datasource": { "type": "tempo", "uid": "${datasource}" },
             "query": "{ resource.service.name = \"products-service\" && (status = error || span.http.status_code >= 500) }",
             "queryType": "traceql",
             "refId": "A"
           }
         ],
         "title": "Recent Errors (Products)",
         "type": "table"
       },
       {
         "datasource": { "type": "tempo", "uid": "${datasource}" },
         "description": "Traces for products-service taking longer than 500ms",
         "gridPos": { "h": 8, "w": 12, "x": 12, "y": 13 },
         "id": 7,
         "options": {
           "cellHeight": "sm",
           "footer": { "countRows": false, "fields": "", "reducer": ["sum"], "show": false },
           "showHeader": true,
           "sortBy": [ { "desc": true, "displayName": "Duration" } ]
         },
         "targets": [
           {
             "datasource": { "type": "tempo", "uid": "${datasource}" },
             "query": "{ resource.service.name = \"products-service\" && duration > 500ms }",
             "queryType": "traceql",
             "refId": "A"
           }
         ],
         "title": "Slow Traces > 500ms (Products)",
         "type": "table"
       },
       {
         "collapsed": false,
         "gridPos": { "h": 1, "w": 24, "x": 0, "y": 21 },
         "id": 10,
         "panels": [],
         "title": "shipping-service (Beyla eBPF Auto-Instrumentation)",
         "type": "row"
       },
       {
         "datasource": { "type": "tempo", "uid": "${datasource}" },
         "description": "Traces for shipping-service with error status or HTTP 500+. This service is auto-instrumented via Beyla eBPF.",
         "gridPos": { "h": 8, "w": 12, "x": 0, "y": 22 },
         "id": 11,
         "options": {
           "cellHeight": "sm",
           "footer": { "countRows": false, "fields": "", "reducer": ["sum"], "show": false },
           "showHeader": true,
           "sortBy": [ { "desc": true, "displayName": "Start time" } ]
         },
         "targets": [
           {
             "datasource": { "type": "tempo", "uid": "${datasource}" },
             "query": "{ resource.service.name = \"shipping-service\" && (status = error || span.http.status_code >= 500) }",
             "queryType": "traceql",
             "refId": "A"
           }
         ],
         "title": "Recent Errors (Shipping - Beyla)",
         "type": "table"
       },
       {
         "datasource": { "type": "tempo", "uid": "${datasource}" },
         "description": "Traces for shipping-service taking longer than 500ms",
         "gridPos": { "h": 8, "w": 12, "x": 12, "y": 22 },
         "id": 12,
         "options": {
           "cellHeight": "sm",
           "footer": { "countRows": false, "fields": "", "reducer": ["sum"], "show": false },
           "showHeader": true,
           "sortBy": [ { "desc": true, "displayName": "Duration" } ]
         },
         "targets": [
           {
             "datasource": { "type": "tempo", "uid": "${datasource}" },
             "query": "{ resource.service.name = \"shipping-service\" && duration > 500ms }",
             "queryType": "traceql",
             "refId": "A"
           }
         ],
         "title": "Slow Traces > 500ms (Shipping - Beyla)",
         "type": "table"
       },
       {
         "collapsed": false,
         "gridPos": { "h": 1, "w": 24, "x": 0, "y": 30 },
         "id": 8,
         "panels": [],
         "title": "Advanced Explorer",
         "type": "row"
       },
       {
         "datasource": { "type": "tempo", "uid": "${datasource}" },
         "description": "Explore all traces without predefined filters. Use TraceQL to build custom queries.",
         "gridPos": { "h": 10, "w": 24, "x": 0, "y": 31 },
         "id": 9,
         "options": {
           "cellHeight": "sm",
           "footer": { "countRows": false, "fields": "", "reducer": ["sum"], "show": false },
           "showHeader": true,
           "sortBy": [ { "desc": true, "displayName": "Start time" } ]
         },
         "targets": [
           {
             "datasource": { "type": "tempo", "uid": "${datasource}" },
             "query": "{ }",
             "queryType": "traceql",
             "refId": "A"
           }
         ],
         "title": "All Traces Explorer",
         "type": "table"
       }
     ],
     "schemaVersion": 38,
     "style": "dark",
     "tags": ["tempo", "traces", "opentelemetry"],
     "templating": {
       "list": [
         {
           "current": { "selected": false, "text": "Tempo", "value": "Tempo" },
           "hide": 0,
           "includeAll": false,
           "label": "Datasource",
           "multi": false,
           "name": "datasource",
           "options": [],
           "query": "tempo",
           "refresh": 1,
           "regex": "",
           "skipUrlSync": false,
           "type": "datasource"
         }
       ]
     },
     "time": { "from": "now-1h", "to": "now" },
     "timepicker": {},
     "timezone": "",
     "title": "Distributed Tracing",
     "uid": "super-traces-poc-v1",
     "version": 1,
     "weekStart": ""
   }
